<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–∞–≤–æ–≤—ã–µ –Ω–æ—Ä–º—ã –¥–ª—è –¥–µ—Ç–µ–π</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
            overflow-x: hidden;
            touch-action: manipulation;
        }
        
        .game-container {
            max-width: 100%;
            min-height: 100vh;
            margin: 0 auto;
            background: white;
            padding: 20px;
            padding-bottom: 100px; /* –û—Ç—Å—Ç—É–ø –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
            position: relative;
        }
        
        @media (min-width: 768px) {
            .game-container {
                max-width: 800px;
                min-height: auto;
                border-radius: 20px;
                margin: 20px auto;
                padding: 30px;
                padding-bottom: 100px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            }
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .header h1 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 1.6rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .stat-item {
            text-align: center;
            flex: 1;
        }
        
        .stat-item .number {
            font-size: 1.5rem;
            font-weight: bold;
            display: block;
        }
        
        .question-block {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 2px solid #e0e0e0;
            min-height: 250px;
        }
        
        .question-text {
            font-size: 1.2rem;
            margin-bottom: 25px;
            line-height: 1.4;
            color: #2c3e50;
            font-weight: 600;
        }
        
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .option-btn {
            background: white;
            border: 2px solid #ddd;
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1rem;
            text-align: left;
            width: 100%;
        }
        
        .option-btn:active {
            transform: scale(0.98);
        }
        
        .option-btn.selected {
            border-color: #2ecc71;
            background: #e8f8ef;
        }
        
        .option-number {
            background: #4a6ee0;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid #4a6ee0;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .checkbox.checked::after {
            content: '‚úì';
            color: #4a6ee0;
            font-weight: bold;
        }
        
        /* –°–æ–æ—Ç–Ω–µ—Å–µ–Ω–∏–µ */
        .matching-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }
        
        .matching-row {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .matching-term {
            flex: 1;
            min-width: 130px;
            background: #4a6ee0;
            color: white;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
        }
        
        .matching-select {
            flex: 1;
            min-width: 130px;
            padding: 12px;
            border: 2px solid #4a6ee0;
            border-radius: 10px;
            font-size: 0.95rem;
            background: white;
        }
        
        /* –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å */
        .sequence-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }
        
        .sequence-item {
            background: white;
            border: 2px solid #f39c12;
            border-radius: 12px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1rem;
        }
        
        .seq-buttons {
            display: flex;
            gap: 8px;
            margin-left: auto;
        }
        
        .seq-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 50%;
            background: #4a6ee0;
            color: white;
            font-size: 1rem;
            cursor: pointer;
        }
        
        .seq-btn:disabled {
            background: #ddd;
            cursor: not-allowed;
        }
        
        /* –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤ */
        .code-blanks {
            background: #f5f5f5;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border: 2px dashed #4a6ee0;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            line-height: 1.6;
        }
        
        .blank {
            display: inline-block;
            min-width: 80px;
            padding: 6px 10px;
            margin: 0 4px;
            border: 2px dashed #999;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            text-align: center;
            font-weight: 500;
        }
        
        .blank.filled {
            border: 2px solid #4a6ee0;
            background: #f0f4ff;
        }
        
        .blank-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 20px;
        }
        
        .blank-option {
            padding: 10px 18px;
            background: white;
            border: 2px solid #4a6ee0;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.95rem;
        }
        
        .blank-option.used {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* –ö–æ–¥ */
        .code-block {
            font-family: 'Courier New', monospace;
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            overflow-x: auto;
            line-height: 1.5;
            font-size: 0.95rem;
        }
        
        .code-line {
            padding: 4px 8px;
            margin: 2px 0;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
        }
        
        .code-line.selected {
            background: rgba(231, 76, 60, 0.2);
            border-left: 3px solid #e74c3c;
        }
        
        /* –°–±–æ—Ä–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã */
        .program-blocks {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }
        
        .program-block {
            background: white;
            border: 2px solid #9b59b6;
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        
        .program-block.selected {
            border-color: #2ecc71;
            background: #e8f8ef;
        }
        
        .program-area {
            min-height: 120px;
            border: 2px dashed #9b59b6;
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: flex-start;
        }
        
        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è - –ò–°–ü–†–ê–í–õ–ï–ù–û */
        .controls {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 15px 20px;
            display: flex;
            gap: 12px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.15);
            z-index: 1000;
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
        }
        
        @media (min-width: 768px) {
            .controls {
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                width: 90%;
                max-width: 760px;
                border-radius: 16px;
            }
        }
        
        .btn {
            padding: 16px 24px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex: 1;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-check {
            background: linear-gradient(135deg, #4a6ee0, #3a5ed0);
            color: white;
        }
        
        .btn-next {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }
        
        .btn-hint {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }
        
        /* –°–æ–æ–±—â–µ–Ω–∏–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ */
        .result-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 25px 35px;
            border-radius: 20px;
            font-size: 1.3rem;
            font-weight: bold;
            text-align: center;
            z-index: 2000;
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: popIn 0.3s ease-out;
        }
        
        @keyframes popIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }
        
        .result-message.correct {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }
        
        .result-message.incorrect {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.4s ease-out;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .game-container {
                padding-bottom: 120px;
            }
            
            .controls {
                padding: 12px 15px;
            }
            
            .btn {
                padding: 14px 20px;
                font-size: 0.95rem;
            }
            
            .matching-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .matching-term, .matching-select {
                width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            .controls {
                flex-direction: column;
                gap: 10px;
                padding: 15px;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="game-container" id="gameContainer">
        <div class="header">
            <h1><i class="fas fa-code"></i> –£—á–∏–º –ø—Ä–∞–≤–æ–≤—ã–º –Ω–æ—Ä–º–∞–º</h1>
            <p class="subtitle">–ò–≥—Ä–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è –ø–æ </p>
        </div>
        
        <div class="stats">
            <div class="stat-item">
                <span class="number" id="questionNumber">1</span>
                <span class="label">–í–û–ü–†–û–°</span>
            </div>
            <div class="stat-item">
                <span class="number" id="score">0</span>
                <span class="label">–ë–ê–õ–õ–´</span>
            </div>
            <div class="stat-item">
                <span class="number" id="correct">0</span>
                <span class="label">–ü–†–ê–í–ò–õ–¨–ù–û</span>
            </div>
        </div>
        
        <div class="question-block fade-in" id="questionBlock">
            <div class="question-text" id="questionText">
                –ó–∞–≥—Ä—É–∑–∫–∞ –≤–æ–ø—Ä–æ—Å–∞...
            </div>
            
            <div id="answerContainer">
                <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ -->
            </div>
        </div>
    </div>
    
    <div class="controls">
        <button class="btn btn-hint" id="hintBtn">
            <i class="fas fa-lightbulb"></i> –ü–æ–¥—Å–∫–∞–∑–∫–∞
        </button>
        <button class="btn btn-check" id="checkBtn">
            <i class="fas fa-check"></i> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
        </button>
        <button class="btn btn-next" id="nextBtn" style="display: none;">
            <i class="fas fa-arrow-right"></i> –°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å
        </button>
    </div>
    
    <div class="result-message" id="resultMessage"></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();
        
        // –í–æ–ø—Ä–æ—Å—ã –±–µ–∑ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π
        const questions = [
            {
                type: 'single',
                question: '–ß—Ç–æ —Ç–∞–∫–æ–µ –∞–ª–≥–æ—Ä–∏—Ç–º?',
                options: [
                    '–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫–æ–º–∞–Ω–¥ –¥–ª—è –∫–æ–º–ø—å—é—Ç–µ—Ä–∞',
                    '–ü—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–∞ —è–∑—ã–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è',
                    '–¢–æ—á–Ω–æ–µ –ø—Ä–µ–¥–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏',
                    '–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ–æ—Ä–º—É–ª–∞'
                ],
                correct: 2
            },
            {
                type: 'multiple',
                question: '–ö–∞–∫–∏–µ —Ç–∏–ø—ã —Ü–∏–∫–ª–æ–≤ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏?',
                options: [
                    '–¶–∏–∫–ª while',
                    '–¶–∏–∫–ª for',
                    '–¶–∏–∫–ª do-while',
                    '–ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª'
                ],
                correct: [0, 1, 2, 3]
            },
            {
                type: 'matching',
                question: '–°–æ–µ–¥–∏–Ω–∏ –ø–æ–Ω—è—Ç–∏—è —Å –∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è–º–∏:',
                leftItems: ['Algorithm', 'Variable', 'Function', 'Bug'],
                rightItems: [
                    'Named container for data',
                    'Step-by-step instruction',
                    'Error in program',
                    'Reusable code block'
                ],
                correctPairs: {
                    'Algorithm': 'Step-by-step instruction',
                    'Variable': 'Named container for data',
                    'Function': 'Reusable code block',
                    'Bug': 'Error in program'
                }
            },
            {
                type: 'sequence',
                question: '–†–∞—Å—Å—Ç–∞–≤—å —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ:',
                steps: [
                    'print("Hello, World!")',
                    '# My first program',
                    'def main():',
                    'if __name__ == "__main__":',
                    '    main()'
                ],
                correctOrder: [1, 2, 0, 3, 4]
            },
            {
                type: 'fill-blanks',
                question: '–ó–∞–ø–æ–ª–Ω–∏ –ø—Ä–æ–ø—É—Å–∫–∏ –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ:',
                code: 'for i in range(10):<br>    <span class="blank" data-id="1">______</span>("Hello!")<br><br>if x > 10:<br>    <span class="blank" data-id="2">______</span>("Big")<br>else:<br>    <span class="blank" data-id="3">______</span>("Small")',
                blanks: {
                    '1': ['print', 'write', 'output'],
                    '2': ['print', 'say', 'show'],
                    '3': ['print', 'display', 'output']
                },
                correct: ['print', 'print', 'print']
            },
            {
                type: 'find-error',
                question: '–ù–∞–π–¥–∏ —Å—Ç—Ä–æ–∫—É —Å –æ—à–∏–±–∫–æ–π:',
                code: [
                    'def calculate(a, b):',
                    '    result = a + b',
                    '    return result',
                    '',
                    'x = 5',
                    'y = "10"',
                    'z = calculate(x, y)',
                    'print(f"Result: {z}")'
                ],
                errorLine: 6
            },
            {
                type: 'build-program',
                question: '–°–æ–±–µ—Ä–∏ –ø—Ä–æ–≥—Ä–∞–º–º—É –¥–ª—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è:',
                blocks: [
                    'def greet(name):',
                    '    print(f"Hello, {name}!")',
                    '',
                    'greet("World")',
                    'greet("Python")'
                ],
                correctOrder: [0, 1, 2, 3, 4]
            }
        ];
        
        let currentQuestion = 0;
        let score = 0;
        let correctAnswers = 0;
        let selectedAnswers = [];
        let activeBlank = null;
        let programBlocks = [];
        
        const elements = {
            questionNumber: document.getElementById('questionNumber'),
            score: document.getElementById('score'),
            correct: document.getElementById('correct'),
            questionText: document.getElementById('questionText'),
            answerContainer: document.getElementById('answerContainer'),
            hintBtn: document.getElementById('hintBtn'),
            checkBtn: document.getElementById('checkBtn'),
            nextBtn: document.getElementById('nextBtn'),
            resultMessage: document.getElementById('resultMessage')
        };
        
        function showResultMessage(message, isCorrect) {
            elements.resultMessage.textContent = message;
            elements.resultMessage.className = `result-message ${isCorrect ? 'correct' : 'incorrect'}`;
            elements.resultMessage.style.display = 'block';
            
            setTimeout(() => {
                elements.resultMessage.style.display = 'none';
            }, 1500);
        }
        
        function initGame() {
            loadQuestion(currentQuestion);
            setupEventListeners();
        }
        
        function loadQuestion(index) {
            if (index >= questions.length) {
                showResults();
                return;
            }
            
            const question = questions[index];
            elements.questionNumber.textContent = index + 1;
            elements.questionText.textContent = question.question;
            elements.answerContainer.innerHTML = '';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å", —Å–∫—Ä—ã–≤–∞–µ–º "–°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å"
            elements.checkBtn.style.display = 'flex';
            elements.nextBtn.style.display = 'none';
            
            selectedAnswers = [];
            activeBlank = null;
            programBlocks = [];
            
            switch (question.type) {
                case 'single':
                    loadSingleChoice(question);
                    break;
                case 'multiple':
                    loadMultipleChoice(question);
                    break;
                case 'matching':
                    loadMatching(question);
                    break;
                case 'sequence':
                    loadSequence(question);
                    break;
                case 'fill-blanks':
                    loadFillBlanks(question);
                    break;
                case 'find-error':
                    loadFindError(question);
                    break;
                case 'build-program':
                    loadBuildProgram(question);
                    break;
            }
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–∞—á–∞–ª—É
            window.scrollTo(0, 0);
        }
        
        function loadSingleChoice(question) {
            const container = document.createElement('div');
            container.className = 'options-container';
            
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('button');
                optionElement.className = 'option-btn';
                optionElement.innerHTML = `
                    <span class="option-number">${String.fromCharCode(65 + index)}</span>
                    <span>${option}</span>
                `;
                
                optionElement.addEventListener('click', () => {
                    document.querySelectorAll('.option-btn').forEach(el => {
                        el.classList.remove('selected');
                    });
                    optionElement.classList.add('selected');
                    selectedAnswers = [index];
                });
                
                container.appendChild(optionElement);
            });
            
            elements.answerContainer.appendChild(container);
        }
        
        function loadMultipleChoice(question) {
            const container = document.createElement('div');
            container.className = 'options-container';
            
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('button');
                optionElement.className = 'option-btn';
                optionElement.innerHTML = `
                    <div class="checkbox"></div>
                    <span>${option}</span>
                `;
                
                optionElement.addEventListener('click', () => {
                    optionElement.classList.toggle('selected');
                    optionElement.querySelector('.checkbox').classList.toggle('checked');
                    
                    if (optionElement.classList.contains('selected')) {
                        selectedAnswers.push(index);
                    } else {
                        selectedAnswers = selectedAnswers.filter(i => i !== index);
                    }
                });
                
                container.appendChild(optionElement);
            });
            
            elements.answerContainer.appendChild(container);
        }
        
        function loadMatching(question) {
            const container = document.createElement('div');
            container.className = 'matching-container';
            
            question.leftItems.forEach((term, index) => {
                const row = document.createElement('div');
                row.className = 'matching-row';
                
                const termDiv = document.createElement('div');
                termDiv.className = 'matching-term';
                termDiv.textContent = term;
                
                const select = document.createElement('select');
                select.className = 'matching-select';
                select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏ –æ—Ç–≤–µ—Ç</option>';
                
                question.rightItems.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item;
                    option.textContent = item;
                    select.appendChild(option);
                });
                
                row.appendChild(termDiv);
                row.appendChild(select);
                container.appendChild(row);
            });
            
            elements.answerContainer.appendChild(container);
        }
        
        function loadSequence(question) {
            const container = document.createElement('div');
            container.className = 'sequence-container';
            
            const shuffledSteps = [...question.steps]
                .map((step, index) => ({step, originalIndex: index}))
                .sort(() => Math.random() - 0.5);
            
            shuffledSteps.forEach((item, currentIndex) => {
                const stepElement = document.createElement('div');
                stepElement.className = 'sequence-item';
                stepElement.innerHTML = `
                    <span>${item.step}</span>
                    <div class="seq-buttons">
                        <button class="seq-btn" ${currentIndex === 0 ? 'disabled' : ''}>‚Üë</button>
                        <button class="seq-btn" ${currentIndex === shuffledSteps.length - 1 ? 'disabled' : ''}>‚Üì</button>
                    </div>
                `;
                stepElement.dataset.originalIndex = item.originalIndex;
                
                const upBtn = stepElement.querySelector('.seq-btn:nth-child(1)');
                const downBtn = stepElement.querySelector('.seq-btn:nth-child(2)');
                
                upBtn.addEventListener('click', () => {
                    if (currentIndex > 0) {
                        const prevElement = container.children[currentIndex - 1];
                        container.insertBefore(stepElement, prevElement);
                        updateSequenceButtons();
                    }
                });
                
                downBtn.addEventListener('click', () => {
                    if (currentIndex < shuffledSteps.length - 1) {
                        const nextElement = container.children[currentIndex + 1];
                        container.insertBefore(nextElement, stepElement);
                        updateSequenceButtons();
                    }
                });
                
                container.appendChild(stepElement);
            });
            
            function updateSequenceButtons() {
                const items = container.children;
                for (let i = 0; i < items.length; i++) {
                    const buttons = items[i].querySelectorAll('.seq-btn');
                    buttons[0].disabled = i === 0;
                    buttons[1].disabled = i === items.length - 1;
                }
            }
            
            updateSequenceButtons();
            elements.answerContainer.appendChild(container);
        }
        
        function loadFillBlanks(question) {
            const container = document.createElement('div');
            container.className = 'code-blanks';
            
            const codeDiv = document.createElement('div');
            codeDiv.innerHTML = question.code;
            
            const optionsDiv = document.createElement('div');
            optionsDiv.className = 'blank-options';
            
            const allOptions = [];
            Object.values(question.blanks).forEach(arr => {
                arr.forEach(opt => {
                    if (!allOptions.includes(opt)) allOptions.push(opt);
                });
            });
            
            allOptions.forEach(option => {
                const optionBtn = document.createElement('button');
                optionBtn.className = 'blank-option';
                optionBtn.textContent = option;
                
                optionBtn.addEventListener('click', function() {
                    if (activeBlank) {
                        activeBlank.textContent = option;
                        activeBlank.classList.add('filled');
                        activeBlank.classList.remove('active');
                        this.classList.add('used');
                        activeBlank = null;
                    }
                });
                
                optionsDiv.appendChild(optionBtn);
            });
            
            setTimeout(() => {
                codeDiv.querySelectorAll('.blank').forEach(blank => {
                    blank.addEventListener('click', function() {
                        codeDiv.querySelectorAll('.blank').forEach(b => {
                            b.classList.remove('active');
                        });
                        this.classList.add('active');
                        activeBlank = this;
                        
                        optionsDiv.querySelectorAll('.blank-option').forEach(btn => {
                            btn.classList.remove('used');
                        });
                    });
                });
            }, 100);
            
            container.appendChild(codeDiv);
            container.appendChild(optionsDiv);
            elements.answerContainer.appendChild(container);
        }
        
        function loadFindError(question) {
            const container = document.createElement('div');
            
            const codeDiv = document.createElement('div');
            codeDiv.className = 'code-block';
            
            question.code.forEach((line, index) => {
                const lineDiv = document.createElement('div');
                lineDiv.className = 'code-line';
                lineDiv.innerHTML = `
                    <span style="color: #95a5a6; margin-right: 10px;">${index + 1}</span>
                    <span>${line}</span>
                `;
                
                lineDiv.addEventListener('click', function() {
                    codeDiv.querySelectorAll('.code-line').forEach(l => {
                        l.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    selectedAnswers = [index + 1];
                });
                
                codeDiv.appendChild(lineDiv);
            });
            
            container.appendChild(codeDiv);
            elements.answerContainer.appendChild(container);
        }
        
        function loadBuildProgram(question) {
            const container = document.createElement('div');
            
            const hint = document.createElement('div');
            hint.style.cssText = 'color: #666; font-size: 0.9rem; margin-bottom: 10px;';
            hint.textContent = '–ö–ª–∏–∫–Ω–∏ –Ω–∞ –±–ª–æ–∫–∏ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ:';
            
            const blocksDiv = document.createElement('div');
            blocksDiv.className = 'program-blocks';
            
            question.blocks.forEach((block, index) => {
                const blockElement = document.createElement('div');
                blockElement.className = 'program-block';
                blockElement.textContent = block;
                blockElement.dataset.index = index;
                
                blockElement.addEventListener('click', () => {
                    if (programBlocks.includes(index)) return;
                    
                    programBlocks.push(index);
                    blockElement.classList.add('selected');
                    updateProgramArea();
                });
                
                blocksDiv.appendChild(blockElement);
            });
            
            const programArea = document.createElement('div');
            programArea.className = 'program-area';
            
            function updateProgramArea() {
                programArea.innerHTML = '';
                programBlocks.forEach(blockIndex => {
                    const blockClone = document.createElement('div');
                    blockClone.className = 'program-block';
                    blockClone.textContent = question.blocks[blockIndex];
                    blockClone.style.background = '#f0f4ff';
                    programArea.appendChild(blockClone);
                });
            }
            
            container.appendChild(hint);
            container.appendChild(blocksDiv);
            container.appendChild(programArea);
            elements.answerContainer.appendChild(container);
        }
        
        function checkAnswer() {
            const question = questions[currentQuestion];
            let isCorrect = false;
            
            switch (question.type) {
                case 'single':
                    isCorrect = selectedAnswers.length === 1 && 
                               selectedAnswers[0] === question.correct;
                    break;
                    
                case 'multiple':
                    if (selectedAnswers.length === question.correct.length) {
                        isCorrect = selectedAnswers.every(answer => 
                            question.correct.includes(answer)
                        );
                    }
                    break;
                    
                case 'matching':
                    const selects = document.querySelectorAll('.matching-select');
                    let allCorrect = true;
                    
                    selects.forEach(select => {
                        const term = select.previousElementSibling.textContent;
                        if (question.correctPairs[term] !== select.value) {
                            allCorrect = false;
                        }
                    });
                    
                    isCorrect = allCorrect && selects.length > 0;
                    break;
                    
                case 'sequence':
                    const sequenceItems = document.querySelectorAll('.sequence-item');
                    const currentOrder = Array.from(sequenceItems).map(item => 
                        parseInt(item.dataset.originalIndex)
                    );
                    isCorrect = JSON.stringify(currentOrder) === 
                               JSON.stringify(question.correctOrder);
                    break;
                    
                case 'fill-blanks':
                    const blanks = document.querySelectorAll('.blank');
                    const filledCorrectly = Array.from(blanks).every((blank, index) => {
                        return blank.textContent === question.correct[index];
                    });
                    isCorrect = filledCorrectly && blanks.length === question.correct.length;
                    break;
                    
                case 'find-error':
                    isCorrect = selectedAnswers.length === 1 && 
                               selectedAnswers[0] === question.errorLine;
                    break;
                    
                case 'build-program':
                    isCorrect = JSON.stringify(programBlocks) === 
                               JSON.stringify(question.correctOrder);
                    break;
            }
            
            if (isCorrect) {
                score += 10;
                correctAnswers++;
                elements.score.textContent = score;
                elements.correct.textContent = correctAnswers;
                
                showResultMessage('–ü—Ä–∞–≤–∏–ª—å–Ω–æ! +10 –±–∞–ª–ª–æ–≤ ‚úÖ', true);
            } else {
                showResultMessage('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚ùå', false);
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å", —Å–∫—Ä—ã–≤–∞–µ–º "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å"
            elements.checkBtn.style.display = 'none';
            elements.nextBtn.style.display = 'flex';
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                if (elements.nextBtn.style.display === 'flex') {
                    nextQuestion();
                }
            }, 3000);
        }
        
        function nextQuestion() {
            currentQuestion++;
            loadQuestion(currentQuestion);
        }
        
        function showResults() {
            const percentage = Math.round((correctAnswers / questions.length) * 100);
            
            let grade = '';
            let icon = '';
            
            if (percentage >= 90) {
                grade = '–û—Ç–ª–∏—á–Ω–æ! üèÜ';
                icon = 'üèÜ';
            } else if (percentage >= 70) {
                grade = '–•–æ—Ä–æ—à–æ! üëç';
                icon = 'üëç';
            } else if (percentage >= 50) {
                grade = '–ù–µ–ø–ª–æ—Ö–æ! üëå';
                icon = 'üëå';
            } else {
                grade = '–ü–æ–ø—Ä–æ–±—É–π –µ—â–µ! üìö';
                icon = 'üìö';
            }
            
            elements.questionText.innerHTML = `
                <h2>${icon} –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h2>
                <p>–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: ${correctAnswers}/${questions.length}</p>
                <p>–ù–∞–±—Ä–∞–Ω–æ –±–∞–ª–ª–æ–≤: ${score}</p>
                <p><strong>${grade}</strong></p>
                <p style="margin-top: 20px; font-size: 1rem;">
                    <button id="restartBtn" style="
                        background: linear-gradient(135deg, #4a6ee0, #3a5ed0);
                        color: white;
                        border: none;
                        border-radius: 12px;
                        padding: 15px 30px;
                        font-size: 1rem;
                        font-weight: 600;
                        cursor: pointer;
                        margin-top: 20px;
                    ">
                        <i class="fas fa-redo"></i> –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞
                    </button>
                </p>
            `;
            
            elements.answerContainer.innerHTML = '';
            elements.hintBtn.style.display = 'none';
            elements.checkBtn.style.display = 'none';
            elements.nextBtn.style.display = 'none';
            
            document.getElementById('restartBtn').addEventListener('click', () => {
                location.reload();
            });
            
            tg.sendData(JSON.stringify({
                action: 'game_complete',
                score: score,
                correct: correctAnswers,
                total: questions.length,
                percentage: percentage
            }));
        }
        
        function setupEventListeners() {
            elements.hintBtn.addEventListener('click', () => {
                const hints = [
                    "–í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ —á–∏—Ç–∞–π –≤–æ–ø—Ä–æ—Å!",
                    "–ü–æ–ø—Ä–æ–±—É–π –∏—Å–∫–ª—é—á–∏—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã!",
                    "–ü–æ–º–Ω–∏ –ø—Ä–æ –ø–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏!",
                    "–ü—Ä–æ–≤–µ—Ä—å —Å–≤–æ–π –æ—Ç–≤–µ—Ç –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π!"
                ];
                showResultMessage(hints[Math.floor(Math.random() * hints.length)], true);
            });
            
            elements.checkBtn.addEventListener('click', checkAnswer);
            elements.nextBtn.addEventListener('click', nextQuestion);
            
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
            document.addEventListener('touchstart', function(e) {
                if (e.touches.length > 1) e.preventDefault();
            }, { passive: false });
            
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function(e) {
                const now = Date.now();
                if (now - lastTouchEnd <= 300) e.preventDefault();
                lastTouchEnd = now;
            }, false);
        }
        
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>